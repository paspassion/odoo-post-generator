<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>G√©n√©rateur de posts r√©seaux sociaux</title>
</head>
<body>
  <h1>üß† G√©n√©rateur de posts r√©seaux sociaux</h1>

  <label>Choisis un mois :</label>
  <select id="mois">
    <option value="08">Ao√ªt</option>
    <option value="09">Septembre</option>
    <option value="10">Octobre</option>
  </select>

  <label>Choisis une ann√©e :</label>
  <select id="annee">
    <option value="2025">2025</option>
    <option value="2026">2026</option>
  </select>

  <p>R√©seaux sociaux :</p>
  <label><input type="checkbox" name="reseaux" value="Facebook"> Facebook</label>
  <label><input type="checkbox" name="reseaux" value="Instagram"> Instagram</label>
  <label><input type="checkbox" name="reseaux" value="LinkedIn"> LinkedIn</label>
  <label><input type="checkbox" name="reseaux" value="TikTok"> TikTok</label>

  <br><br>
  <button onclick="genererPosts()">üéØ G√©n√©rer les posts</button>

  <h2>üìÖ Journ√©es mondiales √† venir</h2>
  <ul id="liste-journees"></ul>

  <h2>üì¢ Posts g√©n√©r√©s</h2>
  <div id="resultat-posts"></div>

  <script>
    async function genererPosts() {
      const mois = document.getElementById('mois').value;
      const annee = document.getElementById('annee').value;
      const reseaux = Array.from(document.querySelectorAll('input[name="reseaux"]:checked')).map(el => el.value);

      const response = await fetch("/api/genere-post", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ mois, annee, reseaux })
      });

      const data = await response.json();

      // Affichage des journ√©es √† venir
      const journeesList = document.getElementById("liste-journees");
      journeesList.innerHTML = "";
      if (reseaux.length === 0) {
        journeesList.innerHTML = "<li>Veuillez s√©lectionner au moins un r√©seau social.</li>";
        return;
      }

      if (data.postages) {
        const avenir = data.postages[reseaux[0]].avenir || [];
        if (avenir.length === 0) {
          journeesList.innerHTML = "<li>Aucune journ√©e √† venir trouv√©e.</li>";
        } else {
          avenir.forEach(j => {
            const li = document.createElement("li");
            li.textContent = `${j.date} : ${j.evenement}`;
            journeesList.appendChild(li);
          });
        }

        // Affichage des posts
        const container = document.getElementById("resultat-posts");
        container.innerHTML = "";
        for (let reseau in data.postages) {
          const post = data.postages[reseau];
          const block = document.createElement("div");
          block.innerHTML = `<h3>${reseau}</h3><p>${post.texte}</p><p><strong>Hashtags :</strong> ${post.hashtags.join(" ")}</p><hr>`;
          container.appendChild(block);
        }

      } else {
        alert("Erreur lors du chargement des journ√©es.");
      }
    }
  </script>
</body>
</html>
